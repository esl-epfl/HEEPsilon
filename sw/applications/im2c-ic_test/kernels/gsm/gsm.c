/*
                              *******************
******************************* C SOURCE FILE *******************************
**                            *******************                          **
**                                                                         **
** project  : CGRA-X-HEEP                                                  **
** filename : gsm.c                                                 **
** version  : 1                                                            **
** date     : 2023-06-23                                                       **
**                                                                         **
*****************************************************************************
**                                                                         **
** Copyright (c) EPFL                                                      **
** All rights reserved.                                                    **
**                                                                         **
*****************************************************************************
*/

/***************************************************************************/
/***************************************************************************/

/**
* @file   gsm.c
* @date   2023-06-23
* @brief  A description of the kernel...
*
*/

#define _GSM_C

/****************************************************************************/
/**                                                                        **/
/*                             MODULES USED                                 */
/**                                                                        **/
/****************************************************************************/
#include <stdint.h>

#include "function.h"
#include "gsm.h"

/****************************************************************************/
/**                                                                        **/
/*                        DEFINITIONS AND MACROS                            */
/**                                                                        **/
/****************************************************************************/
#if CGRA_N_COLS == 2

#define CGRA_COLS       2
#define IN_VAR_DEPTH    3
#define OUT_VAR_DEPTH   1

/****************************************************************************/
/**                                                                        **/
/*                      PROTOTYPES OF LOCAL FUNCTIONS                       */
/**                                                                        **/
/****************************************************************************/

static void        config  (void);
static void        software(void);
static uint32_t    check   (void);

/****************************************************************************/
/**                                                                        **/
/*                            GLOBAL VARIABLES                              */
/**                                                                        **/
/****************************************************************************/

const uint32_t  cgra_imem_gsm[CGRA_IMEM_SIZE] = {  0xab0000, 0xad0000, 0xa090000, 0x60080000, 0x1a090001, 0x72080000, 0x0, 0x6880000d, 0x60080000, 0x1a090001, 0x72080000, 0x0, 0x68880008, 0x0, 0x0, 0x0, 0x0, 0x0, 0xc80000, 0x0, 0x0, 0x0, 0x0, 0x3a180004, 0x0, 0x0, 0x0, 0x0, 0x3a180004, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xab0000, 0xa090000, 0x0, 0x0, 0x0, 0x0, 0x5b90000, 0x67100000, 0x60100000, 0x26700000, 0x0, 0x5b90000, 0x67100000, 0x60100000, 0x26700000, 0x0, 0x0, 0x0, 0x0, 0xab0000, 0xa090000, 0x0, 0x0, 0x0, 0x0, 0x0, 0x3100000, 0x71784000, 0x60090000, 0x36100000, 0x36710000, 0x3100000, 0x71784000, 0x60090000, 0x36100000, 0x36710000, 0x10b00000, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,  };
static uint32_t cgra_kmem_gsm[CGRA_KMEM_SIZE] = {  0x0, 0x3012, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0,
 };

static int32_t cgra_input[CGRA_COLS][IN_VAR_DEPTH]     __attribute__ ((aligned (4)));
static int32_t cgra_output[CGRA_COLS][OUT_VAR_DEPTH]   __attribute__ ((aligned (4)));

static uint32_t	i_d_soft[40];
static uint32_t	i_d_cgra[40];

static uint32_t	o_dmax_soft;
static uint32_t	o_dmax_cgra;


/****************************************************************************/
/**                                                                        **/
/*                           EXPORTED VARIABLES                             */
/**                                                                        **/
/****************************************************************************/

extern kcom_kernel_t gsm_kernel = {
    .kmem   = cgra_kmem_gsm,
    .imem   = cgra_imem_gsm,
    .col_n  = CGRA_COLS,
    .in_n   = IN_VAR_DEPTH,
    .out_n  = OUT_VAR_DEPTH,
    .input  = cgra_input,
    .output = cgra_output,
    .config = config,
    .func   = software,
    .check  = check,
    .name   = "Gsm",
};

/****************************************************************************/
/**                                                                        **/
/*                            LOCAL FUNCTIONS                               */
/**                                                                        **/
/****************************************************************************/

void config()
{
    for(int i = 0; i < 40; i++ )
    {
        i_d_soft[i] = kcom_getRand() % (32767 - -32768 + 1) + -32768;
        i_d_cgra[i] = i_d_soft[i];
    }

	cgra_input[0][0] = i_d_cgra;
	cgra_input[0][1] = -32768;
	cgra_input[0][2] = 39;
	cgra_input[1][0] = 32767;
}

void software(void)
{
    o_dmax_soft = gsm( i_d_soft );
}

uint32_t check(void)
{
    uint32_t errors = 0;

	o_dmax_cgra = cgra_output[1][0];


#if PRINT_CGRA_RESULTS
    PRINTF("------------------------------\n");
    for( uint8_t c = 0; c < CGRA_COLS; c ++)
    {
        for( uint8_t r = 0; r < OUT_VAR_DEPTH; r++ )
        {
            PRINTF("[%d][%d]:%08x\t\t",c,r,cgra_output[c][r]);
        }
        PRINTF("\n");
    }
#endif //PRINT_CGRA_RESULTS


#if PRINT_RESULTS
        PRINTF("\nCGRA\t\tSoft\n");
#endif

    for( int i = 0; i < 1; i++ )
    {
#if PRINT_RESULTS
        PRINTF("%08x\t%08x\t%s\n",
        o_dmax_cgra,
        o_dmax_soft,
        (o_dmax_cgra != o_dmax_soft) ? "Wrong!" : ""
        );
#endif

        if (o_dmax_cgra != o_dmax_soft) {
            errors++;
        }
    }
    return errors;
}

#elif CGRA_N_COLS == 3
        #define CGRA_COLS       3
        #define IN_VAR_DEPTH    3
        #define OUT_VAR_DEPTH   1

        /****************************************************************************/
        /**                                                                        **/
        /*                      PROTOTYPES OF LOCAL FUNCTIONS                       */
        /**                                                                        **/
        /****************************************************************************/

        static void        config  (void);
        static void        software(void);
        static uint32_t    check   (void);

        /****************************************************************************/
        /**                                                                        **/
        /*                            GLOBAL VARIABLES                              */
        /**                                                                        **/
        /****************************************************************************/

        static uint32_t cgra_imem_gsm[CGRA_IMEM_SIZE] = {  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x50100000,  0x0,  0x0,  0x50100000,  0x0,  0x0,  0x50100000,  0x0,  0x0,  0x0,  0x0,  0x0,  0xc80000,  0xa080000,  0x0,  0x10080000,  0x1a080001,  0x0,  0x10080000,  0x1a080001,  0x0,  0x10080000,  0x1a080001,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x2a180004,  0x0,  0x0,  0x2a180004,  0x0,  0x0,  0x2a180004,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xa080000,  0x0,  0x0,  0x0,  0x0,  0x2b80000,  0x0,  0x0,  0x2b80000,  0x0,  0x0,  0x2b80000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xa90000,  0xab0000,  0x0,  0x0,  0x74080000,  0x0,  0x36100000,  0x74080000,  0x0,  0x36100000,  0x74080000,  0x0,  0x36100000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xa080000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x4100000,  0x0,  0x24718000,  0x4100000,  0x36702000,  0x24718000,  0x4100000,  0x36702000,  0x24718000,  0x0,  0x36702000,  0x10b00000,  0x0,  0xa90000,  0x0,  0x0,  0x0,  0x5680000b,  0x0,  0x0,  0x5680000b,  0x20080000,  0x0,  0x56880008,  0x20080000,  0x0,  0x0,  0x20080000,  0x0,  0x0,  0x0,  0x0,  0xa90000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x63786000,  0x0,  0x32100000,  0x63786000,  0x0,  0x32100000,  0x63786000,  0x0,  0x32100000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,   };
        static uint32_t cgra_kmem_gsm[CGRA_KMEM_SIZE] = {  0x0,  0x7012,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,
        };

        static int32_t cgra_input[CGRA_COLS][IN_VAR_DEPTH]     __attribute__ ((aligned (4)));
        static int32_t cgra_output[CGRA_COLS][OUT_VAR_DEPTH]   __attribute__ ((aligned (4)));

        static uint32_t	i_d_soft[40];
        static uint32_t	i_d_cgra[40];

        static uint32_t	o_dmax_soft;
        static uint32_t	o_dmax_cgra;


        /****************************************************************************/
        /**                                                                        **/
        /*                           EXPORTED VARIABLES                             */
        /**                                                                        **/
        /****************************************************************************/

        extern kcom_kernel_t gsm_kernel = {
            .kmem   = cgra_kmem_gsm,
            .imem   = cgra_imem_gsm,
            .col_n  = CGRA_COLS,
            .in_n   = IN_VAR_DEPTH,
            .out_n  = OUT_VAR_DEPTH,
            .input  = cgra_input,
            .output = cgra_output,
            .config = config,
            .func   = software,
            .check  = check,
            .name   = "Gsm",
        };

        /****************************************************************************/
        /**                                                                        **/
        /*                            LOCAL FUNCTIONS                               */
        /**                                                                        **/
        /****************************************************************************/

        void config()
        {
            for(int i = 0; i < 40; i++ )
            {
                i_d_soft[i] = kcom_getRand() % (32767 - -32768 + 1) + -32768;
                i_d_cgra[i] = i_d_soft[i];
            }
            cgra_input[1][0] = 39;
            cgra_input[2][0] = -32768;
            cgra_input[2][1] = 32767;
            cgra_input[2][2] = i_d_cgra;

        }

        void software(void)
        {
            o_dmax_soft = gsm( i_d_soft );
        }

        uint32_t check(void)
        {
            uint32_t errors = 0;

            o_dmax_cgra = cgra_output[0][0];


        #if PRINT_CGRA_RESULTS
            PRINTF("------------------------------\n");
            for( uint8_t c = 0; c < CGRA_COLS; c ++)
            {
                for( uint8_t r = 0; r < OUT_VAR_DEPTH; r++ )
                {
                    PRINTF("[%d][%d]:%08x\t\t",c,r,cgra_output[c][r]);
                }
                PRINTF("\n");
            }
        #endif //PRINT_CGRA_RESULTS


        #if PRINT_RESULTS
                PRINTF("\nCGRA\t\tSoft\n");
        #endif

            for( int i = 0; i < 1; i++ )
            {
        #if PRINT_RESULTS
                PRINTF("%08x\t%08x\t%s\n",
                o_dmax_cgra,
                o_dmax_soft,
                (o_dmax_cgra != o_dmax_soft) ? "Wrong!" : ""
                );
        #endif

                if (o_dmax_cgra != o_dmax_soft) {
                    errors++;
                }
            }
            return errors;
        }








#elif CGRA_N_COLS == 4

    #define CGRA_COLS       4
    #define IN_VAR_DEPTH    2
    #define OUT_VAR_DEPTH   1

    /****************************************************************************/
    /**                                                                        **/
    /*                      PROTOTYPES OF LOCAL FUNCTIONS                       */
    /**                                                                        **/
    /****************************************************************************/

    static void        config  (void);
    static void        software(void);
    static uint32_t    check   (void);

    /****************************************************************************/
    /**                                                                        **/
    /*                            GLOBAL VARIABLES                              */
    /**                                                                        **/
    /****************************************************************************/

    const uint32_t  cgra_imem_gsm[CGRA_IMEM_SIZE] = {  0x1a080000,  0x0,  0x4a080001,  0x0,  0x0,  0x0,  0x4a080001,  0x0,  0x0,  0x0,  0x4a080001,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xc80000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x4100000,  0x0,  0x0,  0x0,  0x4100000,  0x0,  0x0,  0x0,  0x4100000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xad0000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x82786000,  0x0,  0x0,  0x0,  0x82786000,  0x0,  0x0,  0x0,  0x82786000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xa0f0028,  0x0,  0x0,  0x0,  0x4980000d,  0x0,  0x0,  0x0,  0x4980000d,  0x0,  0x0,  0x0,  0x49880009,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x2080000,  0x0,  0x0,  0x0,  0x2080000,  0x0,  0x0,  0x0,  0x2080000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1a080000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x35100000,  0x53700000,  0x0,  0x0,  0x35100000,  0x53700000,  0x0,  0x0,  0x35100000,  0x53700000,  0x10b00000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x5080000,  0x0,  0x0,  0x0,  0x5080000,  0x0,  0x0,  0x0,  0x5080000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xa90000,  0x0,  0x2a180004,  0x61080000,  0x0,  0x0,  0x2a180004,  0x61080000,  0x0,  0x0,  0x2a180004,  0x61080000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x1a080000,  0x0,  0x0,  0x0,  0x2b80000,  0x0,  0x0,  0x0,  0x2b80000,  0x0,  0x0,  0x0,  0x2b80000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0xa90000,  0x0,  0x0,  0x0,  0x0,  0x62100000,  0x2080000,  0x52700000,  0x0,  0x62100000,  0x2080000,  0x52700000,  0x0,  0x62100000,  0x2080000,  0x52700000,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0 };
    static uint32_t cgra_kmem_gsm[CGRA_KMEM_SIZE] = {  0x0,  0xf013,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0,  0x0 };

    static int32_t cgra_input[CGRA_COLS][IN_VAR_DEPTH]     __attribute__ ((aligned (4)));
    static int32_t cgra_output[CGRA_COLS][OUT_VAR_DEPTH]   __attribute__ ((aligned (4)));

    static int32_t	i_x_soft[40];
    static int32_t	i_x_cgra[40];

    static int32_t	o_ret_soft;
    static int32_t	o_ret_cgra;


    /****************************************************************************/
    /**                                                                        **/
    /*                           EXPORTED VARIABLES                             */
    /**                                                                        **/
    /****************************************************************************/

    extern kcom_kernel_t gsm_kernel = {
        .kmem   = cgra_kmem_gsm,
        .imem   = cgra_imem_gsm,
        .col_n  = CGRA_COLS,
        .in_n   = 2,
        .out_n  = 1,
        .input  = cgra_input,
        .output = cgra_output,
        .config = config,
        .func   = software,
        .check  = check,
        .name   = "Gsm",
    };

    /****************************************************************************/
    /**                                                                        **/
    /*                            LOCAL FUNCTIONS                               */
    /**                                                                        **/
    /****************************************************************************/

    void config()
    {
        for(int i = 0; i < 40; i++ )
        {
            i_x_soft[i] = kcom_getRand() %(32767 - -32768 + 1) + -32768;
            i_x_cgra[i] = i_x_soft[i];
        }
        cgra_input[1][0] = i_x_cgra;
        cgra_input[3][0] = 32767;
        cgra_input[3][1] = -32768;

    }

    void software(void)
    {
        o_ret_soft = gsm( i_x_soft );
    }

    uint32_t check(void)
    {
        uint32_t errors = 0;

        o_ret_cgra = cgra_output[3][0];

    #if PRINT_CGRA_RESULTS
        PRINTF("------------------------------\n");
        for( uint8_t c = 0; c < CGRA_COLS; c ++)
        {
            for( uint8_t r = 0; r < OUT_VAR_DEPTH; r++ )
            {
                PRINTF("[%d][%d]:%08x\t\t",c,r,cgra_output[c][r]);
            }
            PRINTF("\n");
        }
    #endif //PRINT_CGRA_RESULTS


    #if PRINT_RESULTS
            PRINTF("\nCGRA\t\tSoft\n");
    #endif

        for( int i = 0; i < 1; i++ )
        {
    #if PRINT_RESULTS
            PRINTF("%08x\t%08x\t%s\n",
            o_ret_cgra,
            o_ret_soft,
            (o_ret_cgra != o_ret_soft) ? "Wrong!" : ""
            );
    #endif

            if (o_ret_cgra != o_ret_soft) {
                errors++;
            }
        }
        return errors;
    }




#endif //CGRA_N_COLS
/****************************************************************************/
/**                                                                        **/
/**                                EOF                                     **/
/**                                                                        **/
/****************************************************************************/